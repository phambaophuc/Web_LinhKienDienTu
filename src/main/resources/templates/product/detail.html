<!DOCTYPE html>
<html lang="en" xmlns:th="">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.productName}"></title>
    <th:block th:replace="layout :: link-css"></th:block>
    <style>
        textarea {
            resize: none;
        }
    </style>
</head>
<body>
<th:block th:replace="layout :: header"></th:block>
<div class="container py-5">
    <div class="row d-flex align-items-center">
        <div class="col-md-4 item-photo">
            <img style="max-width:100%;" th:src="@{'/img/product/' + ${product.image} + '.webp'}"/>
        </div>
        <div class="col-md-6">
            <h3 th:text="${product.productName}"></h3>
            <p th:text="${product.note}"></p>
            <h6 class="title-price"><small>Giá</small></h6>
            <h3 class="mt-0" th:text="${product.price} + '$'"></h3>

            <div class="d-flex">
                <button class="btn btn-success me-2">Đặt hàng</button>
                <button class="btn btn-outline-danger">Thêm vào giỏ hàng</button>
            </div>
        </div>

        <div class="col-xs-9 mt-3">
            <ul class="menu-items">
                <li class="active">Thông tin</li>
            </ul>
            <div style="width:100%;border-top:1px solid silver">
                <div class="my-3 fw-bold" style="font-size:22px">Mô tả sản phẩm</div>
                <pre th:utext="${product.description}"></pre>
            </div>
        </div>

        <div class="container my-5 py-5">
            <div class="row d-flex justify-content-start">
                <div class="col-md-12 col-lg-10">
                    <div class="card text-dark">
                        <div class="card-body p-4">
                            <h4 class="mb-0">Recent comments</h4>
                            <p class="fw-light mb-4 pb-2">Latest Comments section by users</p>

                            <div th:each="comment, commentStatus : ${comments}">
                                <div class="card-body p-4">
                                    <div class="d-flex flex-start">
                                        <img class="rounded-circle shadow-1-strong me-3"
                                             src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(23).webp" alt="avatar" width="60"
                                             height="60" />
                                        <div>
                                            <h6 class="fw-bold mb-1" th:text="${comment.user.fullname}"></h6>
                                            <div class="d-flex align-items-center mb-3">
                                                <p class="mb-0" th:text="${comment.createdAt}">
                                                    <span class="badge bg-primary">Pending</span>
                                                </p>
                                                <a href="#!" class="link-muted"><i class="fas fa-pencil-alt ms-2"></i></a>
                                                <a href="#!" class="link-muted"><i class="fas fa-redo-alt ms-2"></i></a>
                                                <a href="#!" class="link-muted"><i class="fas fa-heart ms-2"></i></a>
                                            </div>
                                            <p class="mb-0" th:utext="${comment.content}" style="white-space: pre-line;"></p>
                                        </div>
                                    </div>
                                </div>
                                <hr class="my-0" th:if="${!commentStatus.last}"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row d-flex justify-content-start">
                <div class="col-md-12 col-lg-10">
                    <form th:action="@{'/product/' + ${product.productId}}" method="POST" th:object="${newComment}">
                        <div class="card-footer py-3 border-0">
                            <div class="d-flex flex-start w-100">
                                <img class="rounded-circle shadow-1-strong me-3"
                                     src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(23).webp" alt="avatar" width="40"
                                     height="40" />
                                <div class="form-outline w-100">
                                    <textarea class="form-control" id="textAreaExample" rows="4"
                                            style="background: #fff;" th:field="${newComment.content}">
                                    </textarea>
                                    <label class="form-label" for="textAreaExample">Message</label>
                                    <div class="float-end mt-2">
                                        <button type="submit" class="btn btn-success btn-sm" id="postCommentBtn">Post comment</button>
                                        <button type="button" class="btn btn-outline-success btn-sm">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<th:block th:replace="layout :: footer"></th:block>
</body>
</html>
<script>
$(document).ready(function() {
    $("#postCommentBtn").click(function(event) {
        if (!isLoggedIn()) {
            event.preventDefault(); // Ngăn chặn gửi biểu mẫu
            alert("Vui lòng đăng nhập để bình luận");
        }
    });

    function isLoggedIn() {
        return $.ajax({
            url: "/api/user/check-authentication",
            method: "GET",
            async: false
        }).responseJSON.authenticated;
    }
});
</script>