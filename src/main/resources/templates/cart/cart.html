<!DOCTYPE html>
<html lang="en" xmlns:th="">
<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng</title>
    <th:block th:replace="layout :: link-css"></th:block>
    <link rel="stylesheet" th:href="@{/css/styleCart.css}">
</head>
<body>
<th:block th:replace="layout :: header"></th:block>
<section class="h-100 h-custom" style="background-color: #d2c9ff;">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-12">
                <div class="card card-registration card-registration-2" style="border-radius: 15px;">
                    <div class="card-body p-0">
                        <div class="row g-0">
                            <div class="col-lg-8 position-relative">
                                <div class="p-5">
                                    <div class="d-flex justify-content-between align-items-center mb-5">
                                        <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>

                                        <div class="mt-2">
                                            <h6 class="mb-0"><a th:href="@{/product}" class="text-body"><i
                                                    class="fas fa-long-arrow-alt-left me-2"></i>Back to shop</a></h6>
                                        </div>
                                    </div>

                                    <div class="row mb-4 d-flex justify-content-between align-items-center" th:each="item : ${cart}">
                                        <div class="col-md-2 col-lg-2 col-xl-2">
                                            <img th:src="@{'https://phuc-public-image.s3.ap-southeast-2.amazonaws.com/' + ${item.getImage()}}"
                                                 class="img-fluid rounded-3" alt="Cotton T-shirt" width="90px">
                                        </div>
                                        <div class="col-md-4 col-lg-4 col-xl-4">
                                            <h6 class="text-black mb-0" th:text="${item.getProductName()}"></h6>
                                        </div>
                                        <div class="col-md-5 col-lg-4 col-xl-3">
                                            <h6 th:text="${'Số lượng: '+ item.getQuantity()}"></h6>
                                            <h6 class="mb-0" th:text="${item.getPrice() + ' $'}"></h6>
                                        </div>
                                        <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                                            <a class="btn btn-sm" th:href="@{'/cart/removeFromCart/' + ${item.getProductId()}}"
                                               onclick="return confirm('Xóa sản phẩm này khỏi giỏ hàng?')">
                                                <i class="fas fa-times"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="position-absolute" style="bottom: 0; left: 50%">
                                        <!-- Phân trang -->
                                        <nav aria-label="Page navigation" th:if="${totalPages > 0}">
                                            <ul class="pagination justify-content-center">
                                                <li class="page-item">
                                                    <a class="page-link" th:href="@{|/cart?page=${currentPage - 1}|}" aria-label="Previous">
                                                        <span aria-hidden="true">&lt;</span>
                                                    </a>
                                                </li>
                                                <li class="page-item" th:each="page : ${#numbers.sequence(0, totalPages - 1)}">
                                                    <a class="page-link" th:href="@{|/cart?page=${page}|}" th:text="${page + 1}"></a>
                                                </li>
                                                <li class="page-item">
                                                    <a class="page-link" th:href="@{|/cart?page=${currentPage + 1}|}" aria-label="Next">
                                                        <span aria-hidden="true">&gt;</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 bg-grey">
                                <div class="p-5">
                                    <h3 class="fw-bold mb-5 mt-2 pt-1">Summary</h3>
                                    <hr class="my-4">

                                    <div class="d-flex justify-content-between mb-4">
                                        <h5 class="text-uppercase" th:text="${totalQuantity + ' items'}"></h5>
                                        <h5></h5>
                                    </div>

                                    <h5 class="text-uppercase mb-3">Shipping</h5>

                                    <div class="mb-4 pb-2">
                                        <select class="select">
                                            <option value="1">Giao hàng tiêu chuẩn</option>
                                            <option value="2">Giao hàng nhanh</option>
                                        </select>
                                    </div>

                                    <h5 class="text-uppercase mb-3">Give code</h5>

                                    <div class="mb-5">
                                        <div class="form-outline">
                                            <input type="text" id="form3Examplea2" class="form-control form-control-lg" />
                                            <label class="form-label" for="form3Examplea2">Enter your code</label>
                                        </div>
                                    </div>

                                    <hr class="my-4">

                                    <form th:action="@{/pay}" method="POST">
                                        <div class="d-flex justify-content-between mb-5">
                                            <h5 class="text-uppercase">Tổng tiền</h5>
                                            <h5 th:text="${totalPrice + ' $'}"></h5>
                                        </div>
                                        <input type="hidden" name="totalPrice" th:value="${totalPrice}">
                                        <button type="submit" class="btn btn-dark btn-block btn-lg" id="thanh-toan"
                                                data-mdb-ripple-color="dark">Thanh toán</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<th:block th:replace="layout :: footer"></th:block>
<script>
    $(document).ready(function() {
        $("#thanh-toan").click(function(event) {
            if (!isLoggedIn()) {
                event.preventDefault(); // Ngăn chặn gửi biểu mẫu
                alert("Bạn cần đăng nhập để sử dụng chức năng này");
            }
        });

        function isLoggedIn() {
            return $.ajax({
                url: "/api/user/check-authentication",
                method: "GET",
                async: false
            }).responseJSON.authenticated;
        }
    });
</script>
</body>
</html>